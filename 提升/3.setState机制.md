# setState机制
## 1.setState异步更新
> setState通过一个**队列机制**实现state更新。当执行setState时，会将需要更新的state合并后放入状态队列，而不会立刻更新this.state，队列机制可以高效地批量更新state。在使用setState改变状态之后，立刻通过this.state去拿最新的状态往往是拿不到的。  

### 使用要点
- 需要基于最新的state做业务，在componentDidUpdate或setState的回调函数里获取  

```
changeTitle:function(event){
    this.setState({
        title:event.target.value
    },() => this.APICallFunction());
},
APICallFunction:function(){
    //Call API with the updated value
}
```

- 下一个state依赖前一个state,给setState传function

```
onClick = () => {
    this.setState((prevState,props) => {
        return {
            quantity:prevState.quantity + 1
        }
    });
    this.setState((prevState,props) => {
        return {
            quantity:prevState.quantity + 1
        }
    })
}
```

![](img/setState.png)